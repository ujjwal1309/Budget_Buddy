<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <!-- BOX ICON -->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <!-- CSS FILE -->
    <link rel="stylesheet" href="./style/edit.css" />

	<link rel="stylesheet" href="./style/formdata.css">
</head>

<body>
   
  
  <!-- SIDEBAR -->
  <section id="sidebar">
	<a href="admin.html" class="brand">
		<img class="bblogo" src="./images/projectnxm201logo.png" alt="">
		
	</a>
	<ul class="side-menu top">
		<li class="active">
			<a href="admin.html">
				<i class='bx bxs-dashboard' ></i>
				<span class="text">Dashboard</span>
			</a>
		</li>
		<li>
			<a href="store.html" >
				<i class='bx bx-card' ></i>
				<span class="text">View Transactions</span>
			</a>
		</li>
		<li>
			<a href="edit.html" >
				<i class='bx bxs-up-arrow-circle' ></i>
				<span class="text">Income</span>
			</a>
		</li>
		<li>
			<a href="register.html">
				<i class='bx bxs-down-arrow-circle' ></i>
				<span class="text">Expense</span>
			</a>
		</li>
		
	</ul>
	<ul class="side-menu">
		
		<li>
			<a href="#" class="logout">
				<i class='bx bx-log-out' ></i>
				<span class="text">Logout</span>
			</a>
		</li>
	</ul>
</section>
	<!-- SIDEBAR -->



	<!-- CONTENT -->
	<section id="content">
		<!-- NAVBAR -->
		<nav>
			<a href="#" class="profile">
				<img  id="profile_pic" src="https://th.bing.com/th/id/OIP.y-nGyqT5AwES8oqp344z4gHaHa?pid=ImgDet&rs=1">
			</a>
			<a href="#" class="nav-link">NAME</a>
			<form action="#">
				<div class="form-input">
					<input type="search" placeholder="Search...">
					<button type="submit" class="search-btn"><i class='bx bx-search' ></i></button>
				</div>
			</form>
			<input type="checkbox" id="switch-mode" hidden>
			<label for="switch-mode" class="switch-mode"></label>
			<a href="#" class="notification">
				<i class='bx bxs-bell' ></i>
				<span class="num">8</span>
			</a>
			
		</nav>
		<main>
			<div class="head-title">
				<div class="left">
					<h1>Income</h1>
					<!-- <ul class="breadcrumb">
						<li>
							<a href="#">Dashboard</a>
						</li>
						<li><i class='bx bx-chevron-right' ></i></li>
						<li>
							<a class="active" href="./index.html" target="_blank">HomePage</a>
						</li>
					</ul> -->
				</div>
				<a href="#" class="btn-download">
					<i class='bx bxs-cloud-download' ></i>
					<span class="text">Download PDF</span>
				</a>
			</div>

			<ul class="box-info">
				<li>
					<i class='bx bxs-dollar-circle' ></i>
					<span class="text">
						<h3 id="total_profit">00.00</h3>
						<p>Total Profit</p>
					</span>
				</li>
				<li>
					<i class='bx bxs-dollar-circle' ></i>
					<span class="text">
						<h3 id="total_income">00.00</h3>
						<p>Total Income</p>
					</span>
				</li>
				<li>
					<i class='bx bxs-dollar-circle' ></i>
					<span class="text">
						<h3 id="total_expense">00.00</h3>
						<p>Total Expense</p>
					</span>
				</li>
			</ul>


			<div class="table-data">
				<div class="order">
					<div class="head">
						<h3>All Income Report</h3>
						<i class='bx bx-search' ></i>
						<i class='bx bx-filter' ></i>
					</div>
					<div id="recent_activity" >

<!-- recent asctivity will post over here -->


<!-- <h1>only income data will apeend over here by date / amount / purpose , you can use filter functinality over here asc and dsc and by date by purpose</h1> -->

					</div>
				</div>
				<div class="todo">
					<div class="head">
						<h3>Add Income Details</h3>
						<i class='bx bx-plus' ></i>
						<i class='bx bx-filter' ></i>
            
					</div>
					<form id="salary-form">

						<label for="title">Title</label>
						<input type="text" id="title" name="title" /><br />

						<label for="income-option">Income From</label>
						<select id="income-option" name="income-option">
							<option value="Salary">Salary</option>
							<option value="Freelancing">Freelancing</option>
							<option value="Investments">Investments</option>
							<option value="Commissions">Commissions</option>
							<option value="Stocks">Stocks</option>
							<option value="YouTube">YouTube</option>
							<option value="Other">Other</option>
						</select><br>
				
						<!-- <label for="title">Salary Type</label><br>
						<input type="text" id="title" name="title"><br> -->
				
						<label for="amount">Amount</label>
						<input type="number" id="amount" name="amount"><br>
				
						<label for="date">Date</label>
						<input type="date" id="date" name="date"><br>
				
				
				
						<label for="comments">Comment</label>
						<!-- <textarea  id="comments" name="comments" rows="4" cols="50"></textarea><br> -->
						<input type="text" id="comments" name="comments"><br>
				
						<input type="submit" style="	background-color: #4bcb87;
						color: rgb(240, 238, 238);
						cursor: pointer;
						width: 150px;
						height: 40px;
						margin-left: 100px;
						border-radius: 50px;" value="Submit">
					</form>
				
				</div>
			</div>

			
		
		<!-- MAIN -->
	</section>

    
	<!-- CONTENT -->

    
</body>
    <script>
		const switchMode = document.getElementById('switch-mode');

switchMode.addEventListener('change', function () {
	if(this.checked) {
		document.body.classList.add('dark');
	} else {
		document.body.classList.remove('dark');
	}
})






//Income DaTA

let formData = document.getElementById("salary-form");
let title = document.getElementById("title");
let amount = document.getElementById("amount");
let date = document.getElementById("date");
let category = document.getElementById("income-option");
let comments = document.getElementById("comments");

formData.addEventListener('submit', async(e)=>{
e.preventDefault();

// console.log("hjdsbhjf");


//sending the data
const res =  await fetch("http://localhost:4000/budget/adddata", {
    method: "POST",
    headers: {
	      "Content-Type": "application/json",
		  "authorization" : `Bearer ${JSON.parse(localStorage.getItem("token"))}`
    },
    body: JSON.stringify({
      title: title.value,
   
       type :"Income",
	   category :category.value,
      amount: amount.value,
	  date: date.value,
      comment: comments.value
	   
    }),
  });

let data = await res.json()
console.log(data);
window.location.reload()
})



//appending Income Data On the page

// recent_activity    ->div id

// /allincome',AllIncome     ->ROUTE

// const displayData =  await fetch("http://localhost:4000/allincome", {
//     method: "GET",
//     headers: {
// 	      "Content-Type": "application/json",
// 		  "authorization" : `Bearer ${JSON.parse(localStorage.getItem("token"))}`
//     },
//     body: JSON.stringify({
//       title: title.value,
   
//        type :"Income",
// 	   category :category.value,
//       amount: amount.value,
// 	  date: date.value,
//       comment: comments.value
	   
//     }),
//   });
// let data = await res.json()
// console.log(data);



//appending t income data

let datacontainer = document.getElementById("recent_activity")
let AllIncome = document.getElementById("total_income");
let AllExpense = document.getElementById("total_expense");
let Profit =  document.getElementById("total_profit");


//appending form data

window.onload = async()=>{
	let res = await fetch("http://localhost:4000/budget/allincome" ,{
		headers :  {
			"authorization" : `Bearer ${JSON.parse(localStorage.getItem("token"))}`
		}

	})
	let formData = await res.json()
console.log(formData);

appendData(formData)

let res2 = await fetch("http://localhost:4000/budget/totalincome" ,{
		headers :  {
			"authorization" : `Bearer ${JSON.parse(localStorage.getItem("token"))}`
		}

	})
let totalIncome = await res2.json();
console.log(totalIncome)

AllIncome.innerText = "₹ "  + totalIncome.TotalIncome



let res3 = await fetch("http://localhost:4000/budget/totalexpense" ,{
		headers :  {
			"authorization" : `Bearer ${JSON.parse(localStorage.getItem("token"))}`
		}

	})
let totalExpense = await res3.json();
console.log(totalExpense)

AllExpense.innerText = "₹ "  + totalExpense.TotalExpense




let res4 = await fetch("http://localhost:4000/budget/totalprofit" ,{
		headers :  {
			"authorization" : `Bearer ${JSON.parse(localStorage.getItem("token"))}`
		}

	})
let totalProfit = await res4.json();
console.log(totalProfit)

Profit.innerText = "₹ "  + totalProfit.totalProfit



}

function appendData(data){

data.forEach(element => {
	// datacontainer
	let title = element.title;
	let category = element.category
	let date = element.date
	let amount = element.amount
	datacontainer.innerHTML += 	`
	<div id = "Datacard">
						<h3 id="titlee">Title:  ${title}</h3>
						
						<p id="categoryy">Category:  ${category}</p>
						
						<p id="datee">Date:  ${date.substring(0,10)}</p>
						<p id="amountt">Amount:  ₹ ${amount}</p>
						<button id="updateBtn">Update</button>
						<button onclick = "deleteData('${element._id}')"  id="deleteBtn" class="deleteBtn">Delete</button>
						</div>
	`
});

}


async function deleteData(dataId) {
  try {
	const id = event.target.dataset.id;

    let res5 = await fetch(`http://localhost:4000/budget/deldata/${dataId}`, {
      method: 'DELETE',
      headers: {
        'authorization': `Bearer ${JSON.parse(localStorage.getItem('token'))}`
      }
    });

    if (id===dataId) {
		const data = await res.json()
    	console.log(data)
    	appendData(data) 
    } else {
		// Error occurred while deleting the data, handle it accordingly
		window.location.reload();
      console.log('Error:', res5.statusText);
    }
  } catch (error) {
    console.log(error);
  }
}


// appending total Income







    </script>
</html>
    