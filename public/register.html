<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<!-- <script src="https://unpkg.com/boxicons@2.1.3/dist/boxicons.js"></script> -->

	<!-- BOX ICON -->
	<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
	<!-- CSS FILE -->
	<link rel="stylesheet" href="./style/register.css" />
	<link rel="stylesheet" href="./style/formdata.css">
	<link rel="stylesheet" href="./style/popup.css">

</head>

<body>


	<!-- SIDEBAR -->
	<section id="sidebar">
		<a href="#" class="brand">
			<img class="bblogo" src="./images/projectnxm201logo.png" alt="">

		</a>
		<ul class="side-menu top">
			<li class="active">
				<a href="/public/admin.html">
					<i class='bx bxs-dashboard'></i>
					<span class="text">Dashboard</span>
				</a>
			</li>
			<li>
				<a href="store.html">
					<i class='bx bx-card'></i>
					<span class="text">View Transactions</span>
				</a>
			</li>
			<li>
				<a href="edit.html">
					<i class='bx bxs-up-arrow-circle'></i>
					<span class="text">Income</span>
				</a>
			</li>
			<li>
				<a href="register.html">
					<i class='bx bxs-down-arrow-circle'></i>
					<span class="text">Expense</span>
				</a>
			</li>

		</ul>
		<ul class="side-menu">

			<li>
				<a href="#" class="logout">
					<i class='bx bx-log-out'></i>
					<span class="text">Logout</span>
				</a>
			</li>
		</ul>
	</section>
	<!-- SIDEBAR -->



	<!-- CONTENT -->
	<section id="content">
		<!-- NAVBAR -->
		<nav>
			<a href="#" class="profile">
				<img id="profile_pic" src="https://th.bing.com/th/id/OIP.y-nGyqT5AwES8oqp344z4gHaHa?pid=ImgDet&rs=1">
			</a>
			<a href="#" class="nav-link">NAME</a>
			<form action="#">
				<div class="form-input">
					<input type="search" placeholder="Search...">
					<button type="submit" class="search-btn"><i class='bx bx-search'></i></button>
				</div>
			</form>
			<input type="checkbox" id="switch-mode" hidden>
			<label for="switch-mode" class="switch-mode"></label>
			<a href="#" class="notification">
				<i class='bx bxs-bell'></i>
				<span class="num">0</span>
			</a>

		</nav>
		<main>
			<div class="head-title">
				<div class="left">
					<h1>Expense</h1>

				</div>
				<a href="#" class="btn-download">
					<i class='bx bxs-cloud-download'></i>
					<span class="text">Download PDF</span>
				</a>
			</div>

			<ul class="box-info">
				<li>
					<i class='bx bxs-dollar-circle'></i>
					<span class="text">
						<h3 id="total_profit">00.00</h3>
						<p>Total Profit</p>
					</span>
				</li>
				<li>
					<i class='bx bxs-dollar-circle'></i>
					<span class="text">
						<h3 id="total_income">00.00</h3>
						<p>Total Income</p>
					</span>
				</li>
				<li>
					<i class='bx bxs-dollar-circle'></i>
					<span class="text">
						<h3 id="total_expense">00.00</h3>
						<p>Total Expense</p>
					</span>
				</li>
			</ul>


			<div class="table-data">
				<div class="order">
					<div class="head">
						<h3>All Expense Report</h3>
						<i class='bx bx-search'></i>
						<i class='bx bx-filter'></i>
					</div>
					<div id="recent_activity">





					</div>
				</div>
				<div class="todo">
					<div class="head">
						<h3>Add Expense Details</h3>
						<i class='bx bx-plus'></i>
						<i class='bx bx-filter'></i>
					</div>
					<!-- <h1>frrom will be appen over herecheckout line no. 153 resiter.html</h1> -->

					<!-- here expense form is present -->

					<form id="salary-form">

						<label for="title">Title</label>
						<input type="text" id="title" name="title" /><br />

						<label for="income-option">Expense On</label>
						<select id="income-option" name="income-option">
							<option value="Education">
								Education
							</option>
							<option value="Groceries">
								Groceries
							</option>
							<option value="Healthcare">
								Health
							</option>
							<option value="Subscriptions">
								Subscriptions
							</option>
							<option value="Clothing">
								Clothing
							</option>
							<option value="Travelling">
								Travelling
							</option>
							<option value="Other">
								Other
							</option>
						</select><br />

						<!-- <label for="title">Salary Type</label><br>
						<input type="text" id="title" name="title"><br> -->

						<label for="amount">Amount</label>
						<input type="number" id="amount" name="amount" /><br />

						<label for="date">Date</label>
						<input type="date" id="date" name="date" /><br />

						<label for="comments">Comment</label>
						<!-- <textarea id="comments" name="comments" rows="4" cols="50"></textarea -->
						<input type="text" id="comments" name="comments"><br>


						<input id="submitBtn" 
						style="background-color: #4bcb87;
						color: white;
						cursor: pointer;
						width: 150px;
						height: 40px;
						margin-left: 100px;
						border-radius: 50px;" class="submitBtn" type="submit" value="Submit" />
					</form>
				</div>
			</div>



			<!-- MAIN -->
	</section>

	<div id="pop">
		<div id="popup" class="overlay">
			<div class="wrapper">
				<a href="#">3<span class="multiply">&times;</span>4</a>
				<div class="column details">
					<div class="signin">
						<h1>Update Your Data</h1>
						<form id="uin">
							<label for="title">Title</label>
							<input type="text" id="utitle" name="title" /><br />


							<label for="income-option">Expense On</label>

							<select style="width: 400px; height: 40px;   background: #eee; border: none; padding-left: 20px;padding-right: 20px;"
							id="ucategory" name="income-option">
								<option value="Education">Education</option>
								<option value="Groceries">Groceries</option>
								<option value="Healthcare">Health</option>
								<option value="Subscriptions">Subscriptions</option>
								<option value="Clothing">Clothing</option>
								<option value="Travelling">Travelling</option>
								<option value="Other">Other</option>
							</select><br/>
							<label for="amount">Amount</label>
							<input type="number" id="uamount" name="amount" /><br />

							<label for="date">Date</label>
							<input type="date" id="udate" name="date" /><br />

							<label for="comments">Comment</label>
							<!-- <textarea id="comments" name="comments" rows="4" cols="50"></textarea -->
							<input type="text" id="ucomments" name="comments"><br>


							<button oonclick="updateData(userid, id)"  id="submitBtn" style="	background-color: #4bcb87;
						color: white;
						cursor: pointer;
						width: 400px;
						height: 40px;
						margin-left: 0px;
						border-radius: 50px;" class="submitBtn" type="submit" value="Submit" >SUBMIT </button>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
	<script>
		$('.signup').hide();
		$('#signup, #signup').on(
			'click',
			function () {
				$('.signin, .signup').toggle()
			}
		)
	</script>
	<!-- CONTENT -->


</body>
<script>
	const switchMode = document.getElementById('switch-mode');

	switchMode.addEventListener('change', function () {
		if (this.checked) {
			document.body.classList.add('dark');
		} else {
			document.body.classList.remove('dark');
		}
	})



	//expenses data
	let formData = document.getElementById("salary-form");
	let title = document.getElementById("title");
	let amount = document.getElementById("amount");
	let date = document.getElementById("date");
	let category = document.getElementById("income-option");
	let comments = document.getElementById("comments");
	let AllIncome = document.getElementById("total_income");
	let AllExpense = document.getElementById("total_expense");
	let Profit = document.getElementById("total_profit");

	formData.addEventListener('submit', async (e) => {
		e.preventDefault();
		// console.log("hjdsbhjf");


		//sending the data


		const res = await fetch("http://localhost:4000/budget/adddata", {
			method: "POST",
			headers: {
				"Content-Type": "application/json",
				"authorization": `Bearer ${JSON.parse(localStorage.getItem("token"))}`
			},
			body: JSON.stringify({
				title: title.value,

				type: "Expense",
				category: category.value,
				amount: amount.value,
				date: date.value,
				comment: comments.value

			}),
		});
		let data = await res.json()
		console.log(data);


		window.location.reload();




	})

	let upformData = document.getElementById("uin");
	let uptitle = document.getElementById("utitle");
	let upamount = document.getElementById("uamount");
	let update = document.getElementById("udate");
	let upcategory = document.getElementById("ucategory");
	let upcomments = document.getElementById("ucomments");

	async function updateData(userid, id) {
  try {
    let resup = await fetch(`http://localhost:4000/budget/updata/${userid}`, {
      method: 'PUT',
      headers: {
        'authorization': `Bearer ${JSON.parse(localStorage.getItem('token'))}`
      },
      body: JSON.stringify({
        title: uptitle.value,
        type: "Expense",
        category: upcategory.value,
        amount: upamount.value,
        date: update.value,
        comment: upcomments.value
      })
    });

    if (id === userid) {
      const updata = await res.json();
      console.log(updata);
  
	
	  window.location.reload();
		
      
    } else {
      // Error occurred while updating the data, handle it accordingly
	}
  } catch (error) {
    console.log(error);
  }
}



	let datacontainer = document.getElementById("recent_activity")

	//appending form data

	window.onload = async () => {
		const res = await fetch("http://localhost:4000/budget/allexpense", {
			headers: {
				"authorization": `Bearer ${JSON.parse(localStorage.getItem("token"))}`
			}

		})
		let formData = await res.json()
		console.log(formData);

		appendData(formData)
		




		let res2 = await fetch("http://localhost:4000/budget/totalincome", {
			headers: {
				"authorization": `Bearer ${JSON.parse(localStorage.getItem("token"))}`
			}

		})
		let totalIncome = await res2.json();
		console.log(totalIncome)

		AllIncome.innerText = "₹ " + totalIncome.TotalIncome



		let res3 = await fetch("http://localhost:4000/budget/totalexpense", {
			headers: {
				"authorization": `Bearer ${JSON.parse(localStorage.getItem("token"))}`
			}

		})
		let totalExpense = await res3.json();
		console.log(totalExpense)

		AllExpense.innerText = "₹ " + totalExpense.TotalExpense




		let res4 = await fetch("http://localhost:4000/budget/totalprofit", {
			headers: {
				"authorization": `Bearer ${JSON.parse(localStorage.getItem("token"))}`
			}

		})
		let totalProfit = await res4.json();
		console.log(totalProfit)

		Profit.innerText = "₹ " + totalProfit.totalProfit



	}

	function appendData(data) {

		data.forEach(element => {
			// datacontainer
			let title = element.title;
			let category = element.category
			let date = element.date
			let amount = element.amount
			datacontainer.innerHTML += `
	<div id = "Datacard">
						<h3 id="titlee">Title:  ${title}</h3>
						
						<p id="categoryy">Category:  ${category}</p>
						
						<p id="datee">Date:  ${date.substring(0, 10)}</p>
						<p id="amountt">Amount:  ₹ ${amount}</p>
						<button  id="updateBtn"> <a href="#popup" class="trigger" id="login" >Update</a></button>
						<button onclick = "deleteData('${element._id}')"  id="deleteBtn" class="deleteBtn">Delete</button>
						</div>
	`
						const userid =element._id

		});


	}

	async function deleteData(dataId) {
		try {
			const id = event.target.dataset.id;

			let res5 = await fetch(`http://localhost:4000/budget/deldata/${dataId}`, {
				method: 'DELETE',
				headers: {
					'authorization': `Bearer ${JSON.parse(localStorage.getItem('token'))}`
				}
			});

			if (id === dataId) {
				const data = await res.json()
				console.log(data)
				appendData(data)
			} else {
				// Error occurred while deleting the data, handle it accordingly
				window.location.reload();
				console.log('Error:', res5.statusText);
			}
		} catch (error) {
			console.log(error);
		}
	}

	

</script>

</html>